# 一种支持数据聚合的内裤管理系统

Jupyter 笔记本可以用代码生成出一篇动态的文档，Semantic Media Wiki 的每一篇文档都可以把整个 wiki 当做知识库来生成动态的文档。有没有一种易用的方式能快捷地输入我的内裤库存信息，同时又把强大的动态文档能力封装成各种社区创作的文档插件，由它们生成动态的内裤库存文档、洗衣日程表？

## 个人使用场景

不是所有人都会想把自己的裤存信息转换为结构化数据，但想象你是一名开放世界独立游戏开发者，你想要从巨多的网页剪藏、调研数据中整理出一些内裤装备信息，你希望从现实世界的文本生成游戏里使用的内裤装备数据，把现实世界的无结构文本作为唯一知识源（Single Source Of Truth），现在基本没有能做到这一点的易用的工具。如果你想要开发的开放世界游戏内的本体数量在百万级，你肯定会想要让你的社区有这么一款易用的本体编辑器。

### 本地计算

计算所用的代码也是一篇笔记，而笔记又是能分享的，这让计算常态化。

如果一个计算笔记不依赖于局部状态，而只定义符合一些规范的全局状态查询，那它会比较容易被分享到社区里。除了主动的查询以外，计算笔记也可以被动地接收一个信号，对信号包含的数据进行一些变换后返回另一个信号，这样有的计算笔记就可以作为中间节点被其他计算笔记调用。

所以一篇计算笔记应该要能访问两个接口：

1. 对全局状态的 GraphQL 查询（带有 Schema 带来的智能提示，方便撰写）
1. 信号收发框架（CSP 或 Actor 或者称为 Saga ）

由于查询和信号都是字符串，适合序列化后用互联网协议传输，所以可以把每一篇计算笔记做成 Web API，通过 web 接口调用和发送信号。

#### 流程

有一些计算过程不是简单的从输入到输出的映射，而可能是定时任务、信号监听器等需要常驻内存的过程，这种过程计算量不大，可以用运行时加载的 saga 插件来实现。

### 数据存储

数据存储是一种带副作用的计算，所以其实也是一篇笔记。

发往这篇笔记的信号中的数据可以被转发到某个存储服务里，比如可以发送到文件系统，也可以先发到一个负责加密的笔记里，再发送到文件系统。

### 聚合别的笔记的数据

聚合操作所用的代码是一组笔记，它可能是由三部分组成：

1. 界面模板，比如显示一个用户友好的按钮组告诉用户本笔记支持哪些操作
1. 信号发射器（Action Creator），可能在用户按下某个按钮后它会向总线发射一个信号，这个信号可能被某个支持聚合操作的笔记接收到
1. 聚合计算笔记，被一个信号激活后，它查询知识库，并发射信号把结果发送给界面模板显示出来

## 组织使用场景

### 数据同步

某个角色的数据可以同步到这个角色所属的组织的服务器里。

### 分布式查询

### 远程过程调用

### 综合观察者

将接收到的数据分类、精炼的角色是综合观察者，他们会作为服务器暴露出可订阅的信息流，信息流一般是主题明确的。

接受者可能会设置一个触发器，在匹配到某种类型的信息后调用某个计算笔记，比如把它存起来。
